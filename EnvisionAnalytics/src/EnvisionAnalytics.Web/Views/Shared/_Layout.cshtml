@using System.Text.Json
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    var snackbarSuccess = TempData["SnackbarSuccess"] as string ?? ViewData["SnackbarSuccess"] as string;
    var snackbarError = TempData["SnackbarError"] as string ?? ViewData["SnackbarError"] as string;
    var currentPathAndQuery = (Context.Request.Path + Context.Request.QueryString.ToString());
    if (string.IsNullOrWhiteSpace(currentPathAndQuery))
    {
        currentPathAndQuery = "/";
    }
    var isAuthenticated = User?.Identity?.IsAuthenticated ?? false;
    var userDisplayName = User?.Identity?.Name ?? string.Empty;
    var userInitialSource = (userDisplayName ?? string.Empty).Trim();
    var userInitial = string.IsNullOrEmpty(userInitialSource) ? "?" : char.ToUpperInvariant(userInitialSource[0]).ToString();
}
<!doctype html>
<html lang="@System.Globalization.CultureInfo.CurrentUICulture.Name">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EnvisionAnalytics - @ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="/css/site.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
</head>
<body class="ea-body">
    <div class="ea-body__canvas" aria-hidden="true">
        <svg class="ea-body__constellations" viewBox="0 0 1440 720" preserveAspectRatio="none" focusable="false">
            <g>
                <path d="M30 420 L200 260 L420 320 L640 180 L860 320 L1120 260 L1340 360" />
                <path d="M80 120 L260 80 L420 200 L520 80 L760 140 L960 60 L1260 140 L1400 60" />
                <path d="M120 520 L360 600 L520 480 L760 560 L980 420 L1240 520" />
                <path d="M200 300 L320 440 L540 420 L760 300 L960 420 L1180 380" />
            </g>
            <g>
                <circle cx="200" cy="260" r="3.2" />
                <circle cx="420" cy="320" r="2.4" />
                <circle cx="640" cy="180" r="2.8" />
                <circle cx="860" cy="320" r="2.6" />
                <circle cx="1120" cy="260" r="2.3" />
                <circle cx="1340" cy="360" r="2.5" />
                <circle cx="80" cy="120" r="2" />
                <circle cx="260" cy="80" r="2.7" />
                <circle cx="520" cy="80" r="2.1" />
                <circle cx="760" cy="140" r="2.8" />
                <circle cx="960" cy="60" r="2.2" />
                <circle cx="1260" cy="140" r="2.4" />
                <circle cx="120" cy="520" r="2.5" />
                <circle cx="360" cy="600" r="2.1" />
                <circle cx="520" cy="480" r="2.7" />
                <circle cx="760" cy="560" r="2.4" />
                <circle cx="980" cy="420" r="2.9" />
                <circle cx="1240" cy="520" r="2.1" />
            </g>
        </svg>
        <div class="ea-body__dots ea-body__dots--left"></div>
        <div class="ea-body__dots ea-body__dots--right"></div>
        <div class="ea-body__glow ea-body__glow--one"></div>
        <div class="ea-body__glow ea-body__glow--two"></div>
    </div>
    <div class="ea-shell">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">@Localizer["EnvisionAnalytics"]</a>
                <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
                    @if (isAuthenticated)
                {
                            <a asp-controller="Account" asp-action="Profile" class="navbar-avatar me-2" aria-label="@Localizer["ProfileLink"]">
                                <span>@userInitial</span>
                            </a>
                            <span class="navbar-text text-light me-2">@userDisplayName</span>
                    <form method="post" asp-controller="Account" asp-action="Logout">
                                <button class="btn btn-sm btn-outline-light">@Localizer["Logout"]</button>
                    </form>
                }
                else
                {
                            <a class="btn btn-sm btn-outline-light me-2" href="/Account/Login">@Localizer["Login"]</a>
                            <a class="btn btn-sm btn-outline-light" href="/Account/Register">@Localizer["Register"]</a>
                }
                        <!-- Language selector -->
                        <div class="ms-3">
                            <form id="langForm" method="get" action="/Localization/SetCulture">
                                <input type="hidden" name="returnUrl" value="@currentPathAndQuery" />
                                    <select name="culture" id="cultureSelect" class="form-select form-select-sm" onchange="document.getElementById('langForm').submit()" aria-label="Selecionar idioma">
                                    <option value="en-US" selected="@(System.Threading.Thread.CurrentThread.CurrentCulture.Name == "en-US" ? "selected" : null)">EN (US) ðŸ‡ºðŸ‡¸</option>
                                    <option value="pt-BR" selected="@(System.Threading.Thread.CurrentThread.CurrentCulture.Name == "pt-BR" ? "selected" : null)">PT (BR) ðŸ‡§ðŸ‡·</option>
                                    <option value="es-ES" selected="@(System.Threading.Thread.CurrentThread.CurrentCulture.Name == "es-ES" ? "selected" : null)">ES (ES) ðŸ‡ªðŸ‡¸</option>
                                </select>
                            </form>
                        </div>
            </div>
        </div>
    </nav>
    <main class="ea-main container mt-4" role="main">
        @RenderBody()
    </main>
    <footer class="ea-footer" aria-label="@Localizer["FooterLabel"]">
        <div class="ea-footer__wave" aria-hidden="true">
            <svg viewBox="0 0 1440 120" preserveAspectRatio="none" focusable="false">
                <path d="M0,96 C240,32 480,160 720,96 C960,32 1200,160 1440,96 L1440,0 L0,0 Z" />
            </svg>
        </div>
        <div class="ea-footer__halo" aria-hidden="true"></div>
        <div class="ea-footer__stars" aria-hidden="true"></div>
        <div class="container ea-footer__wrap">
            <div class="ea-footer__headline">
                <span class="ea-footer__badge">
                    <svg class="ea-footer__badge-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M12 2.5l1.8 4.9 5.2.2-4.1 3.1 1.4 5-4.3-2.8-4.3 2.8 1.4-5-4.1-3.1 5.2-.2L12 2.5Z" />
                    </svg>
                    @Localizer["FooterBadge"]
                </span>
                <p class="ea-footer__title">@Localizer["FooterSignature"]</p>
                <p class="ea-footer__subtitle">@Localizer["FooterDisclaimer"]</p>
            </div>
            <div class="ea-footer__panels">
                <div class="ea-footer__panel">
                    <span class="ea-footer__panel-label">@Localizer["FooterConnectLabel"]</span>
                    <div class="ea-footer__actions" role="list">
                        <a class="ea-footer__icon-link ea-footer__icon-mail" role="listitem" href="mailto:mtbraum@gmail.com?subject=Hello%20Matheus" aria-label="@Localizer["FooterEmailLabel"]" title="@Localizer["FooterEmailLabel"]">
                            <span class="visually-hidden">@Localizer["FooterEmailLabel"]</span>
                            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M2 6.5A1.5 1.5 0 0 1 3.5 5h17A1.5 1.5 0 0 1 22 6.5v11A1.5 1.5 0 0 1 20.5 19H3.5A1.5 1.5 0 0 1 2 17.5v-11zM4 7v1.2l8 5 8-5V7H4z" fill="currentColor" />
                            </svg>
                        </a>
                        <a class="ea-footer__icon-link" role="listitem" href="https://github.com/ThBraum" target="_blank" rel="noreferrer" aria-label="@Localizer["FooterGithubLabel"]" title="@Localizer["FooterGithubLabel"]">
                            <span class="visually-hidden">@Localizer["FooterGithubLabel"]</span>
                            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M12 2C6.48 2 2 6.58 2 12.25c0 4.5 2.87 8.31 6.84 9.66.5.1.68-.22.68-.48 0-.24-.01-.88-.01-1.72-2.78.62-3.37-1.37-3.37-1.37-.45-1.18-1.11-1.5-1.11-1.5-.9-.64.07-.63.07-.63 1 .07 1.53 1.06 1.53 1.06.89 1.56 2.34 1.11 2.91.85.09-.66.35-1.11.63-1.37-2.22-.26-4.55-1.14-4.55-5.06 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.3.1-2.72 0 0 .85-.28 2.79 1.05a9.16 9.16 0 0 1 5.08 0c1.93-1.33 2.78-1.05 2.78-1.05.55 1.42.2 2.46.1 2.72.64.72 1.02 1.63 1.02 2.75 0 3.93-2.33 4.8-4.55 5.05.36.32.68.94.68 1.9 0 1.37-.01 2.47-.01 2.81 0 .26.18.58.69.48A10 10 0 0 0 22 12.25C22 6.58 17.52 2 12 2Z" />
                            </svg>
                        </a>
                        <a class="ea-footer__icon-link" role="listitem" href="https://www.linkedin.com/in/matheus-thomaz-braum/" target="_blank" rel="noreferrer" aria-label="@Localizer["FooterLinkedInLabel"]" title="@Localizer["FooterLinkedInLabel"]">
                            <span class="visually-hidden">@Localizer["FooterLinkedInLabel"]</span>
                            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Zm-9.75 15H6.1V10.1h3.15V18Zm-1.58-9a1.85 1.85 0 1 1 0-3.7 1.85 1.85 0 0 1 0 3.7Zm11.33 9h-3.15v-4.5c0-1.08-.02-2.46-1.5-2.46-1.5 0-1.73 1.17-1.73 2.38V18h-3.14V10.1h3.01v1.07h.04c.42-.8 1.44-1.64 2.97-1.64 3.18 0 3.76 2.1 3.76 4.84V18Z" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    </div>
    <div id="snackbar" class="snackbar" role="status" aria-live="polite" aria-hidden="true">
        <span class="snackbar__icon bi" aria-hidden="true"></span>
        <span class="snackbar__text"></span>
        <button type="button" class="snackbar__close" aria-label="Fechar aviso" title="Fechar">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function () {
            const snackbar = document.getElementById('snackbar');
            const snackbarText = snackbar?.querySelector('.snackbar__text');
            const snackbarIcon = snackbar?.querySelector('.snackbar__icon');
            const snackbarClose = snackbar?.querySelector('.snackbar__close');
            const iconByType = {
                success: 'bi-check-circle-fill',
                error: 'bi-x-circle-fill'
            };

            function clearTimers() {
                const hideId = snackbar?.dataset.hideTimeoutId;
                const fadeId = snackbar?.dataset.fadeTimeoutId;
                if (hideId) {
                    clearTimeout(Number(hideId));
                }
                if (fadeId) {
                    clearTimeout(Number(fadeId));
                }
                if (snackbar) {
                    delete snackbar.dataset.hideTimeoutId;
                    delete snackbar.dataset.fadeTimeoutId;
                }
            }

            function hideSnackbar() {
                if (!snackbar) return;
                clearTimers();
                snackbar.classList.remove('show', 'is-fading', 'snackbar-success', 'snackbar-error');
                snackbar.setAttribute('aria-hidden', 'true');
            }

            window.showSnackbar = function (message, type) {
                if (!snackbar || !snackbarText || !message) return;
                const kind = type === 'error' ? 'error' : 'success';
                snackbarText.textContent = message;
                if (snackbarIcon) {
                    snackbarIcon.className = `snackbar__icon bi ${iconByType[kind]}`;
                }
                snackbar.classList.remove('snackbar-success', 'snackbar-error', 'show', 'is-fading');
                snackbar.classList.add(kind === 'success' ? 'snackbar-success' : 'snackbar-error', 'show');
                snackbar.setAttribute('aria-hidden', 'false');
                clearTimers();
                const fadeTimeoutId = window.setTimeout(() => snackbar.classList.add('is-fading'), 3500);
                const hideTimeoutId = window.setTimeout(() => hideSnackbar(), 5000);
                snackbar.dataset.fadeTimeoutId = fadeTimeoutId.toString();
                snackbar.dataset.hideTimeoutId = hideTimeoutId.toString();
            };

            if (snackbarClose) {
                snackbarClose.addEventListener('click', hideSnackbar);
            }

            document.addEventListener('click', function (evt) {
                const toggleButton = evt.target.closest('.toggle-password');
                if (!toggleButton) return;
                const targetId = toggleButton.getAttribute('data-target');
                const input = document.getElementById(targetId);
                if (!input) return;
                const isHidden = input.getAttribute('type') === 'password';
                input.setAttribute('type', isHidden ? 'text' : 'password');
                const icon = toggleButton.querySelector('i');
                if (icon) {
                    icon.classList.toggle('bi-eye');
                    icon.classList.toggle('bi-eye-slash');
                }
                toggleButton.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
            });

            function renderQueuedSnackbars() {
                const successMessage = @Html.Raw(JsonSerializer.Serialize(snackbarSuccess ?? string.Empty));
                const errorMessage = @Html.Raw(JsonSerializer.Serialize(snackbarError ?? string.Empty));
                if (successMessage)
                {
                    window.showSnackbar(successMessage, 'success');
                }
                if (errorMessage)
                {
                    window.showSnackbar(errorMessage, 'error');
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', renderQueuedSnackbars);
            } else {
                renderQueuedSnackbars();
            }
        })();
    </script>
    @RenderSection("Scripts", required: false)
</body>
</html>